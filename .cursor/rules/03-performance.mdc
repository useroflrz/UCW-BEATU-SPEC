# 性能与可观测性

- **播放器选型**：统一使用 ExoPlayer（Media3），支持 DASH/HLS，多码率切换、缓存与自适应码流需通过 `CacheDataSource` 与 `AdaptiveTrackSelection` 配置。
- **视频流容器**：Feed 主场景使用 `ViewPager2`（纵向）+ Paging3 + DiffUtil。`ViewPager2` 本质运行在 RecyclerView 之上，可继续沿用 `ListAdapter`、`AsyncPagingDataDiffer`。严禁全量 `notifyDataSetChanged`。
- **播放器复用池**：维护 1~3 个 ExoPlayer 实例（或全局单例 + SurfaceView 复用），通过 attach/detach 将 Surface/PlayerView 绑定到当前可见 Item。上一条离屏即 `pause/release`，下一条提前 `prepare`。
- **预加载策略**：使用 ExoPlayer 预缓冲 + `CacheDataSource` 下载前 1–2 MB，实现首帧 < 500 ms；正在播放第 N 条时，后台预加载 N+1。结合封面占位图，`onReady` 后才移除。
- **内存管理**：
  - 滑出屏幕立即释放或复用 Player，避免多个实例常驻。
  - 在 `ViewPager2` 背后 RecyclerView 的 `onViewRecycled` 中清理播放器引用、手势监听等，防止泄漏。
  - 监控内存峰值，建立缓存上限（视频缓存、封面、评论列表等）。
- **网络优化**：OkHttp + Retrofit + 协程，配置磁盘缓存、重试与弱网降级（自动降清晰度 / 提示重试）。记录成功率、重试次数。
- **初始化与可观测性**：Application 关键初始化异步化，使用 SplashScreen API。建设播放 KPI：播放成功率≥99%、首帧<500ms、卡顿率<2%、FPS 55~60、冷启动<2.5s，并通过 Profiler/指标面板记录截图。
- **日志 & 埋点**：每个手势（点赞/评论/横屏）与 AI 能力调用需埋点到 Observability 工程，便于追踪。
